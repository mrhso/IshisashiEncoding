# GB 18030
## 所收编码
### 实际存在
- [GB 18030-2000](https://openstd.samr.gov.cn/bzgk/gb/newGbInfo?hcno=4F885660EB8B3AC463C2ED336DB3B67B)
- [GB 18030-2005](https://openstd.samr.gov.cn/bzgk/gb/newGbInfo?hcno=C344D8D120B341A8DD328954A9B27A99)
- [GB 18030-2022](https://openstd.samr.gov.cn/bzgk/gb/newGbInfo?hcno=A1931A578FE14957104988029B0833D3)

## 解说
GB 18030 的创制目标是基本兼容 GB/T 2312 与 GBK，且达到 UTF 的效果。

GB 18030-2000 为原本，在 Windows 代码页为 CP 54936。

GB 18030-2005 在 2000 的基础上互换了「ḿ」和「」的映射。

GB 18030-2022 在 2005 的基础上以互换映射和删除字形的手法将 PUA 遗留全部消除。

## 字节结构
|字节数|第一字节|第二字节|第三字节|第四字节|码位数|注释|
|-|-|-|-|-|-|-|
|单字节|0x00\~0x7F||||128||
|双字节|0x81\~0xFE|0x40\~0x7E, 0x80\~0xFE|||23940|第二字节跳过了 0x7F。|
|四字节|0x81\~0xFE|0x30\~0x39|0x81\~0xFE|0x30\~0x39|1587600|实际使用 1087996 个。|

虽然码位数摆在这里，实际上很难用这么多。

## 与 UCS 的对应关系
### 单字节（特指 0x00\~0x7F）
GB/T 2312 的单字节部分和 UCS 的 U+0000\~U+007F 都源自 ASCII，因此相同。

### 双字节
源自 GBK、GB/T 2312，因此没有转换公式。

### 四字节（2000）
BMP 部分是将双字节没有的 BMP 部分顺次排下来。

而 non-BMP 部分则是直接通过 UCS Code Point 的转换公式转换而来的。

### non-BMP
根据 GB 18030 原文，0x90308130\~0xE339FE39 留给 UCS non-BMP 区域，于是可得转换公式。

定义「/」为整除（保留整数部分）、「%」为求模，两者为同级运算。

UCS Code Point 记作 U，则公式为：

0x1000000((U-0x10000)/12600+0x90)+0x10000((U-0x10000)%12600/1260+0x30)+0x100((U-0x10000)%12600%1260/10+0x81)+((U-0x10000)%12600%1260%10+0x30)

即：

0x1000000((U-0x10000)/12600+0x90)+0x10000((U-0x10000)/1260%10+0x30)+0x100((U-0x10000)/10%126+0x81)+((U-0x10000)%10+0x30)

拆开来看，就可以这么理解：

先将 UCS Code Point 减去 0x10000，记作 U₀。

然后将 U₀ 除以 12600，取出商和余数，分别记作 a₁ 和 b₁。（即：(0x39-0x30+1)(0xFE-0x81+1)(0x39-0x30+1)=12600）

将 b₁ 除以 1260，取出商和余数，分别记作 a₂ 和 b₂。（即：(0xFE-0x81+1)(0x39-0x30+1)=1260）

再将 b₂ 除以 10，取出商和余数，分别记作 a₃ 和 b₃。（即：0x39-0x30+1=10）

则四个字节分别是：
- a₁+0x90（即：a₁ 表示是第几次 12600 循环）
- a₂+0x30（即：a₂ 表示是第几次 1260 循环）
- a₃+0x81（即：a₃ 表示是第几次 10 循环）
- b₃+0x30（即：b₃ 表示 10 循环后的第几个）

### U+D800\~U+DFFF
GB 18030 并没有映射这块。因为这一块不会定义任何字符，都是拿来给 UTF-16 表示 non-BMP 的。
